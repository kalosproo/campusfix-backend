<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CampusFix Admin</title>
  <style>
    body{font-family:system-ui,Arial;margin:16px;background:#f6f8fb;color:#0b2545}
    h1{margin:0 0 12px}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 8px 30px rgba(16,24,40,0.06)}
    th,td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left}
    th{background:linear-gradient(90deg,#0066ff,#4b4fe1);color:#fff}
    button{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
    .fix{background:#16a34a;color:#fff}
    .img{max-width:120px;border-radius:8px}
    a{display:inline-block;margin-bottom:12px}
  </style>
</head>
<body>
  <a href="/">← Back</a>
  <h1>Admin — CampusFix</h1>
  <div id="tableWrap">Loading...</div>

  <script>
    function escapeHtml(s){ if (s===null||s===undefined) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

    async function load() {
      const wrap = document.getElementById('tableWrap');
      try {
        const res = await fetch('/api/issues');
        const rows = await res.json();
        if (!Array.isArray(rows)) { wrap.innerText = 'Failed to load'; return; }
        if (rows.length === 0) { wrap.innerHTML = '<div style="padding:12px">No reports</div>'; return; }

        let html = '<table><thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Building</th><th>Description</th><th>Status</th><th>Action</th></tr></thead><tbody>';
        rows.forEach(r => {
          html += '<tr><td>' + r.id + '</td><td>' + escapeHtml(r.name) + '</td><td>' + escapeHtml(r.email) + '</td><td>' + escapeHtml(r.building) + '</td><td>' + escapeHtml(r.description) + '</td><td>' + (r.status === 'Resolved' ? 'Resolved' : 'Open') + '</td><td>' + (r.status === 'Open' ? '<form method="POST" action="/api/resolve/' + r.id + '"><button class="fix" type="submit">Mark Fixed</button></form>' : '—') + '</td></tr>';
        });
        html += '</tbody></table>';
        wrap.innerHTML = html;
      } catch (err) {
        wrap.innerHTML = '<div style="padding:12px;color:#c00">Failed to load</div>';
        console.error(err);
      }
    }

    load();
  </script>
</body>
</html>